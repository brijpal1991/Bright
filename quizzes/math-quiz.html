<!-- math-quiz.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Math Quiz - BrightMinds</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background-color: #fff8dc;
      font-family: 'Segoe UI', sans-serif;
    }
    .quiz-container {
      max-width: 900px;
      margin: 3em auto;
      padding: 2em;
      background: #ffffff;
      border-radius: 15px;
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
    }
    .question-img {
      max-width: 100px;
      display: block;
      margin: 1em auto;
    }
    .question {
      font-size: 1.5em;
      margin-bottom: 1em;
      text-align: center;
    }
    .option button {
      width: 100%;
      padding: 0.75em;
      font-size: 1.1em;
      border-radius: 10px;
      border: 2px solid #ddd;
      background-color: #f9f9f9;
      transition: background-color 0.3s;
	  margin-bottom:5px;
    }
    .option button:hover {
      background-color: #d1e7dd;
    }
    .feedback, .score-board, .timer-board {
      text-align: center;
      font-size: 1.2em;
      margin-top: 1em;
    }
    .progress {
      height: 20px;
    }
    .play-again {
      text-align: center;
      margin-top: 1.5em;
    }
    nav a {
      margin-right: 1em;
    }
  </style>
</head>
<body>
  <nav class="navbar navbar-expand-lg navbar-light bg-light px-4">
    <a class="navbar-brand" href="../index.html">BrightMinds</a>
    <div class="collapse navbar-collapse">
      <ul class="navbar-nav me-auto">
        <li class="nav-item"><a class="nav-link" href="animal-sounds.html">Animal Sound</a></li>
        <li class="nav-item"><a class="nav-link active" href="#">Math Quiz</a></li>
        <!-- <li class="nav-item"><a class="nav-link" href="social-quiz.html">Social Quiz</a></li> -->
      </ul>
    </div>
  </nav>

  <div class="container quiz-container">
    <h2 class="text-center mb-4">➕ Math Quiz - Level <span id="level">1</span></h2>
    <div class="progress mb-3">
      <div id="progressBar" class="progress-bar" role="progressbar" style="width: 0%"></div>
    </div>
    <div id="quizBox">
      <div id="questionImage"></div>
      <div class="question" id="questionText"></div>
      <div id="optionsContainer" class="mb-3"></div>
      <div class="feedback" id="feedback"></div>
      
      <div class="timer-board">
        Time Left: <span id="timer">30</span> seconds
      </div>
    </div>
    <div class="play-again" style="display:none;">
      <button class="btn btn-primary" onclick="restartQuiz()">Play Again</button>
    </div>
    <div class="score-board">
        Score: <span id="score">0</span> / <span id="total">0</span>
      </div>
  </div>

  <audio id="correctSound" src="../assets/sounds/correct.mp3"></audio>
  <audio id="wrongSound" src="../assets/sounds/wrong.mp3"></audio>

<script>
const levels = [
  { min: 1, max: 5 },   // Level 1
  { min: 5, max: 10 },   // Level 2
  { min: 10, max: 15 },   // Level 3
  { min: 15, max: 20 }   // Level 4
];

let current = 0;
let score = 0;
let level = 1;
let timer;
let timeLeft = 30;

const totalQuestions = 20; // total per game

const correctSound = document.getElementById('correctSound');
const wrongSound = document.getElementById('wrongSound');

function getRandomInt(min, max) {
  return Math.floor(Math.random() * (max - min + 1)) + min;
}

function shuffleArray(arr) {
  return arr.sort(() => Math.random() - 0.5);
}

function generateQuestion(level) {
  const range = levels[level - 1] || levels[0];
  let num1 = getRandomInt(range.min, range.max);
  let num2 = getRandomInt(range.min, range.max);
  
  const ops = ["+", "-", "×", "÷"];
  const op = ops[getRandomInt(0, ops.length - 1)];
  let question, answer;

  switch(op) {
    case "+":
      answer = num1 + num2;
      question = `${num1} + ${num2} = ?`;
      break;
    case "-":
      if (num1 < num2) [num1, num2] = [num2, num1]; // no negatives
      answer = num1 - num2;
      question = `${num1} - ${num2} = ?`;
      break;
    case "×":
      answer = num1 * num2;
      question = `${num1} × ${num2} = ?`;
      break;
    case "÷":
      answer = num1; // force exact division
      num1 = num1 * num2;
      question = `${num1} ÷ ${num2} = ?`;
      break;
  }

  // Generate options
  let options = [answer];
  while (options.length < 4) {
    let wrong = getRandomInt(answer - 3, answer + 3);
    if (wrong !== answer && wrong >= 0 && !options.includes(wrong)) {
      options.push(wrong);
    }
  }
  
  return {
    question,
    answer,
    options: shuffleArray(options)
  };
}

function loadQuestion() {
  clearInterval(timer);
  timeLeft = 30;
  document.getElementById('timer').textContent = timeLeft;
  timer = setInterval(() => {
    timeLeft--;
    document.getElementById('timer').textContent = timeLeft;
    if (timeLeft <= 0) {
      clearInterval(timer);
      checkAnswer(null);
    }
  }, 1000);

  if (current >= totalQuestions) {
    endQuiz();
    return;
  }

  // Adjust level dynamically
  if (score >= 8) level = 2;
  if (score >= 12) level = 3;
  if (score >= 15) level = 4;
  
  document.getElementById('level').textContent = level;

  const q = generateQuestion(level);
  document.getElementById('questionText').textContent = q.question;
  document.getElementById('total').textContent = totalQuestions;
  const optionsBox = document.getElementById('optionsContainer');
  optionsBox.innerHTML = '';
  document.getElementById('questionImage').innerHTML = ''; // no static image for now

  q.options.forEach(option => {
    const btn = document.createElement('button');
    btn.className = 'btn btn-light option';
    btn.textContent = option;
    btn.onclick = () => checkAnswer(option, q.answer);
    const div = document.createElement('div');
    div.className = 'option';
    div.appendChild(btn);
    optionsBox.appendChild(div);
  });
  
  document.getElementById('feedback').textContent = '';
  updateProgress();
}

function checkAnswer(selected, correct) {
  clearInterval(timer);
  const feedback = document.getElementById('feedback');
  if (selected === correct) {
    feedback.textContent = "✅ Correct!";
    feedback.style.color = "green";
    score++;
    correctSound.play();
  } else {
    feedback.textContent = `❌ Wrong! Correct answer is: ${correct}`;
    feedback.style.color = "red";
    wrongSound.play();
  }
  document.getElementById('score').textContent = score;
  current++;
  setTimeout(loadQuestion, 1500);
}

function endQuiz() {
  document.getElementById('quizBox').style.display = 'none';
  document.querySelector('.play-again').style.display = 'block';
  updateProgress();
}

function restartQuiz() {
  current = 0;
  score = 0;
  level = 1;
  document.getElementById('score').textContent = score;
  document.getElementById('quizBox').style.display = 'block';
  document.querySelector('.play-again').style.display = 'none';
  loadQuestion();
}

function updateProgress() {
  const percent = Math.round((current / totalQuestions) * 100);
  document.getElementById('progressBar').style.width = percent + '%';
}

window.onload = loadQuestion;
</script>
</body>
</html>